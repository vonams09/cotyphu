<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monopoly Bank ‚Äì Game Loader</title>

    <!-- ===== FONTS ===== -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;700;800&family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;600&display=swap"
        rel="stylesheet">

    <!-- ===== ESPTOOL ===== -->
    <script src="https://unpkg.com/esptool-js@0.5.6/dist/web/index.js"></script>

    <style>
        :root {
            --primary: #0081c2;
            --secondary: #e74c3c;
            --accent: #f1c40f;
            --bg: #eef1f5;
            --card-bg: #ffffff;
            --text-main: #1a1a1a;
            --text-muted: #6b7280;
            --success: #27ae60;

            --font-main: 'Inter', system-ui, sans-serif;
            --font-title: 'Be Vietnam Pro', sans-serif;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 40px 20px;
            font-family: var(--font-main);
            background: linear-gradient(180deg,
                    #e5e7eb 0%,
                    #dfe3e8 50%,
                    #d6dbe1 100%);
            color: var(--text-main);
        }


        .container {
            max-width: 560px;
            margin: auto;
            display: flex;
            flex-direction: column;
            gap: 22px;
        }

        .card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 34px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, .08);
            border: 1px solid rgba(0, 0, 0, .04);
        }

        /* HEADER */
        .title {
            font-family: var(--font-title);
            font-size: 1.75rem;
            font-weight: 800;
            text-align: center;
            color: var(--primary);
            margin-bottom: 6px;
        }

        .subtitle {
            text-align: center;
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 28px;
        }

        /* STATUS */
        .status-box {
            background: #1e272e;
            color: #7efaff;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            padding: 16px;
            border-radius: 12px;
            border: 1px solid #000;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, .3);
            margin-bottom: 22px;
            min-height: 24px;
        }

        .loading {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 1
            }

            50% {
                opacity: .6
            }

            100% {
                opacity: 1
            }
        }

        /* BUTTONS */
        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        .btn {
            border: none;
            border-radius: 12px;
            padding: 16px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all .25s ease;
        }

        .btn-connect {
            background: var(--primary);
            color: #fff;
        }

        .btn-connect:hover {
            transform: translateY(-2px);
        }

        .btn-flash {
            background: var(--secondary);
            color: #fff;
        }

        .btn-flash:hover:not(:disabled) {
            background: #d63031;
            transform: translateY(-2px);
        }

        .btn:disabled {
            background: #e5e7eb;
            color: #9ca3af;
            cursor: not-allowed;
        }

        /* PROGRESS */
        .progress-wrapper {
            margin-top: 28px;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .progress-container {
            height: 10px;
            background: #e5e7eb;
            border-radius: 999px;
            overflow: hidden;
        }

        #bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #27ae60, #2ecc71);
            transition: width .3s ease;
        }

        /* GUIDE */
        .guide h3 {
            font-family: var(--font-title);
            color: var(--primary);
            font-size: 1.25rem;
            margin-top: 0;
        }

        .guide p {
            font-size: 0.95rem;
            color: var(--text-muted);
            line-height: 1.7;
        }

        .guide ul {
            list-style: none;
            padding: 0;
        }

        .guide li {
            position: relative;
            padding-left: 30px;
            margin-bottom: 16px;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .guide li::before {
            content: "‚úì";
            position: absolute;
            left: 0;
            top: 0;
            color: var(--secondary);
            font-weight: 800;
        }

        .note {
            background: #fffbe6;
            border: 1px solid #ffe58f;
            border-radius: 12px;
            padding: 16px;
            font-size: 0.85rem;
            color: #7c2d12;
            margin-top: 20px;
        }

        .footer {
            text-align: center;
            font-size: 12px;
            color: #9ca3af;
            margin-bottom: 10px;
        }
    </style>
</head>

<body>

    <div class="container">

        <!-- ===== FLASHER ===== -->
        <div class="card">
            <div class="title">üé≤ C·ªú T·ª∂ PH√ö</div>
            <div class="subtitle">Tr√¨nh c·∫≠p nh·∫≠t Firmware ‚Ä¢ v1.0.2</div>

            <div id="log" class="status-box">&gt; ƒêang ch·ªù thi·∫øt b·ªã...</div>

            <div class="btn-group">
                <button id="connect" class="btn btn-connect">üîå K·∫øt n·ªëi ESP32</button>
                <button id="flash" class="btn btn-flash" disabled>üöÄ B·∫Øt ƒë·∫ßu n·∫°p Game</button>
            </div>

            <div class="progress-wrapper">
                <div class="progress-text">
                    <span>Ti·∫øn tr√¨nh</span>
                    <span id="percent">0%</span>
                </div>
                <div class="progress-container">
                    <div id="bar"></div>
                </div>
            </div>
        </div>

        <!-- ===== GUIDE ===== -->
        <div class="card guide">
            <h3>üìò H∆∞·ªõng d·∫´n c·∫≠p nh·∫≠t</h3>
            <p>Vui l√≤ng l√†m theo c√°c b∆∞·ªõc d∆∞·ªõi ƒë√¢y ƒë·ªÉ c·∫≠p nh·∫≠t game an to√†n.</p>

            <ul>
                <li>S·ª≠ d·ª•ng c√°p USB c√≥ h·ªó tr·ª£ truy·ªÅn d·ªØ li·ªáu.</li>
                <li>Nh·∫•n ‚ÄúK·∫øt n·ªëi ESP32‚Äù v√† ch·ªçn ƒë√∫ng c·ªïng thi·∫øt b·ªã.</li>
                <li>Nh·∫•n ‚ÄúB·∫Øt ƒë·∫ßu n·∫°p Game‚Äù v√† ch·ªù ƒë·∫øn khi ho√†n t·∫•t.</li>
                <li>Thi·∫øt b·ªã s·∫Ω t·ª± kh·ªüi ƒë·ªông v√†o game sau khi n·∫°p xong.</li>
            </ul>

            <div class="note">
                üí° N·∫øu kh√¥ng th·∫•y thi·∫øt b·ªã, h√£y th·ª≠ ƒë·ªïi c·ªïng USB ho·∫∑c c√°p kh√°c.
            </div>
        </div>

        <div class="card guide">
            <h3>üìò H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng & ƒë·∫•u n·ªëi</h3>

            <p>
                Trang web n√†y d√πng ƒë·ªÉ n·∫°p game <b>C·ªù T·ª∑ Ph√∫ ‚Äì Monopoly Bank</b>
                v√†o thi·∫øt b·ªã th√¥ng qua c√°p USB. Ng∆∞·ªùi d√πng kh√¥ng c·∫ßn c√†i Arduino hay ph·∫ßn m·ªÅm k·ªπ thu·∫≠t.
            </p>

            <h4>üîß 1. ƒê·∫•u n·ªëi ph·∫ßn c·ª©ng</h4>
            <ul>
                <li>S·ª≠ d·ª•ng bo m·∫°ch <b>ESP32</b> ƒë√£ ƒë∆∞·ª£c l·∫Øp s·∫µn v√†o thi·∫øt b·ªã ng√¢n h√†ng.</li>
                <li>C·∫Øm c√°p <b>USB (USB-C ho·∫∑c Micro-USB)</b> t·ª´ ESP32 v√†o m√°y t√≠nh.</li>
                <li>C√°p ph·∫£i h·ªó tr·ª£ <b>truy·ªÅn d·ªØ li·ªáu</b> (kh√¥ng d√πng c√°p ch·ªâ s·∫°c).</li>
                <li>Thi·∫øt b·ªã s·∫Ω ƒë∆∞·ª£c c·∫•p ngu·ªìn tr·ª±c ti·∫øp qua c·ªïng USB.</li>
            </ul>

            <h4>üåê 2. Y√™u c·∫ßu tr√¨nh duy·ªát</h4>
            <ul>
                <li>S·ª≠ d·ª•ng <b>Google Chrome</b> ho·∫∑c <b>Microsoft Edge</b>.</li>
                <li>Kh√¥ng h·ªó tr·ª£ Safari ho·∫∑c Firefox.</li>
                <li>M√°y t√≠nh Windows ho·∫∑c macOS ƒë·ªÅu s·ª≠ d·ª•ng ƒë∆∞·ª£c.</li>
            </ul>

            <h4>üîå 3. K·∫øt n·ªëi thi·∫øt b·ªã</h4>
            <ul>
                <li>Nh·∫•n n√∫t <b>‚ÄúK·∫øt n·ªëi ESP32‚Äù</b> tr√™n giao di·ªán.</li>
                <li>Tr√¨nh duy·ªát s·∫Ω hi·ªán danh s√°ch c·ªïng k·∫øt n·ªëi.</li>
                <li>Ch·ªçn thi·∫øt b·ªã c√≥ t√™n <b>CP210x</b>, <b>CH340</b> ho·∫∑c <b>USB Serial</b>.</li>
                <li>Sau khi k·∫øt n·ªëi th√†nh c√¥ng, n√∫t <b>‚ÄúB·∫Øt ƒë·∫ßu n·∫°p Game‚Äù</b> s·∫Ω ƒë∆∞·ª£c m·ªü.</li>
            </ul>

            <h4>üöÄ 4. N·∫°p game</h4>
            <ul>
                <li>Nh·∫•n <b>‚ÄúB·∫Øt ƒë·∫ßu n·∫°p Game‚Äù</b>.</li>
                <li>Kh√¥ng r√∫t c√°p USB v√† kh√¥ng ƒë√≥ng tr√¨nh duy·ªát trong qu√° tr√¨nh n·∫°p.</li>
                <li>Thanh ti·∫øn tr√¨nh s·∫Ω hi·ªÉn th·ªã % n·∫°p.</li>
                <li>Khi ho√†n t·∫•t, thi·∫øt b·ªã s·∫Ω t·ª± kh·ªüi ƒë·ªông l·∫°i.</li>
            </ul>

            <h4>üéÆ 5. S·ª≠ d·ª•ng giao di·ªán game</h4>
            <ul>
                <li>Truy c·∫≠p ƒë·ªãa ch·ªâ hi·ªÉn th·ªã tr√™n m√†n h√¨nh thi·∫øt b·ªã ho·∫∑c mDNS (n·∫øu c√≥).</li>
                <li>M·ªói ng∆∞·ªùi ch∆°i ch·ªçn <b>nh√¢n v·∫≠t</b> tr√™n m√†n h√¨nh.</li>
                <li>Ng√¢n h√†ng d√πng ƒë·ªÉ <b>chuy·ªÉn ti·ªÅn</b>, <b>thu ph√≠</b> v√† <b>ph√°t th∆∞·ªüng</b>.</li>
                <li>M·ªçi giao d·ªãch ƒë·ªÅu hi·ªÉn th·ªã trong <b>nh·∫≠t k√Ω giao d·ªãch</b>.</li>
            </ul>

            <div class="note">
                ‚ö†Ô∏è L∆∞u √Ω: Kh√¥ng r√∫t c√°p USB khi ƒëang n·∫°p game.
                N·∫øu g·∫∑p l·ªói k·∫øt n·ªëi, h√£y th·ª≠ ƒë·ªïi c·ªïng USB ho·∫∑c c√°p kh√°c.
            </div>
        </div>


        <div class="footer">
            ¬© 2024 Monopoly Bank Project ‚Ä¢ Boardgame Community
        </div>
    </div>

    <script type="module">
let port, esploader;

const logEl = document.getElementById("log");
const bar = document.getElementById("bar");
const percentEl = document.getElementById("percent");
const btnConnect = document.getElementById("connect");
const btnFlash = document.getElementById("flash");

function setStatus(text, loading = false) {
  logEl.textContent = "> " + text;
  logEl.classList.toggle("loading", loading);
}

if (!("serial" in navigator)) {
  setStatus("Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ Web Serial (h√£y d√πng Chrome)");
  btnConnect.disabled = true;
}

/* ===== CONNECT ===== */
btnConnect.onclick = async () => {
  try {
    setStatus("Gi·ªØ n√∫t BOOT tr√™n ESP32 r·ªìi b·∫•m K·∫øt n·ªëi...", true);

    port = await navigator.serial.requestPort();

    esploader = new window.ESPLoader({
      port,
      baudrate: 115200,   // ‚ö†Ô∏è BAUD TH·∫§P ‚Äì ·ªîN ƒê·ªäNH
      terminal: {
        writeLine: t => setStatus(t)
      }
    });

    await esploader.main();

    setStatus("ESP32 ƒë√£ s·∫µn s√†ng");
    btnFlash.disabled = false;
    btnConnect.textContent = "‚úì ƒê√£ k·∫øt n·ªëi ESP32";
    btnConnect.style.background = "#27ae60";

  } catch (e) {
    setStatus("Kh√¥ng th·ªÉ k·∫øt n·ªëi ‚Äì h√£y gi·ªØ BOOT khi b·∫•m K·∫øt n·ªëi");
  }
};

/* ===== FLASH ===== */
btnFlash.onclick = async () => {
  try {
    btnFlash.disabled = true;
    setStatus("ƒêang n·∫°p firmware...", true);

    const res = await fetch("firmware/cotyphu.bin");
    const bin = await res.arrayBuffer();

    await esploader.writeFlash({
      flashSize: "keep",
      data: [
        { address: 0x0, data: bin } // ‚ö†Ô∏è MERGED.BIN ‚Üí 0x0
      ],
      progress: p => {
        const percent = Math.floor(p * 100);
        bar.style.width = percent + "%";
        percentEl.textContent = percent + "%";
      }
    });

    bar.style.width = "100%";
    percentEl.textContent = "100%";
    setStatus("Ho√†n t·∫•t! ESP32 ƒëang kh·ªüi ƒë·ªông l·∫°i.");

  } catch (e) {
    setStatus("L·ªói khi n·∫°p firmware");
    btnFlash.disabled = false;
  }
};
</script>


</body>


</html>


